import { __decorate, __metadata, __param } from "tslib";
import { Directive, Inject, ElementRef } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { fromEvent, merge, Observable } from 'rxjs';
import { map, switchMap, takeUntil, tap } from 'rxjs/operators';
import { stopPropagation } from './scrollbar/common';
var ScrollViewport = /** @class */ (function () {
    function ScrollViewport(viewPort, document) {
        this.viewPort = viewPort;
        this.document = document;
        this.nativeElement = viewPort.nativeElement;
    }
    Object.defineProperty(ScrollViewport.prototype, "clientHeight", {
        // Get viewport size, clientHeight or clientWidth
        get: function () {
            return this.nativeElement.clientHeight;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ScrollViewport.prototype, "clientWidth", {
        get: function () {
            return this.nativeElement.clientWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ScrollViewport.prototype, "scrollHeight", {
        get: function () {
            return this.nativeElement.scrollHeight;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ScrollViewport.prototype, "scrollWidth", {
        get: function () {
            return this.nativeElement.scrollWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ScrollViewport.prototype, "scrollTop", {
        // Get viewport scroll offset, scrollTop or scrollLeft
        get: function () {
            return this.nativeElement.scrollTop;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ScrollViewport.prototype, "scrollLeft", {
        get: function () {
            return this.nativeElement.scrollLeft;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ScrollViewport.prototype, "scrollMaxX", {
        // Get the available scrollable size
        get: function () {
            return this.scrollWidth - this.clientWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ScrollViewport.prototype, "scrollMaxY", {
        get: function () {
            return this.scrollHeight - this.clientHeight;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ScrollViewport.prototype, "contentHeight", {
        get: function () {
            return this.contentWrapperElement.clientHeight;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Activate viewport pointer events such as 'hovered' and 'clicked' events
     */
    ScrollViewport.prototype.activatePointerEvents = function (propagate, destroyed) {
        var _this = this;
        this.hovered = new Observable(function (subscriber) {
            // Stream that emits when pointer is moved over the viewport (used to set the hovered state)
            var mouseMoveStream = fromEvent(_this.nativeElement, 'mousemove', { passive: true });
            var mouseMove = propagate ? mouseMoveStream : mouseMoveStream.pipe(stopPropagation());
            // Stream that emits when pointer leaves the viewport (used to remove the hovered state)
            var mouseLeave = fromEvent(_this.nativeElement, 'mouseleave').pipe(map(function () { return false; }));
            merge(mouseMove, mouseLeave).pipe(tap(function (e) { return subscriber.next(e); }), takeUntil(destroyed)).subscribe();
        });
        this.clicked = new Observable(function (subscriber) {
            var mouseDown = fromEvent(_this.nativeElement, 'mousedown', { passive: true }).pipe(tap(function (e) { return subscriber.next(e); }));
            var mouseUp = fromEvent(_this.nativeElement, 'mouseup', { passive: true }).pipe(tap(function () { return subscriber.next(false); }));
            mouseDown.pipe(switchMap(function () { return mouseUp; }), takeUntil(destroyed)).subscribe();
        });
    };
    /**
     * Set this directive as a non-functional wrapper, called when a custom viewport is used
     */
    ScrollViewport.prototype.setAsWrapper = function () {
        // In this case the default viewport and the default content wrapper will act as a mask
        this.nativeElement.className = 'ng-native-scrollbar-hider ng-scroll-layer';
        if (this.nativeElement.firstElementChild) {
            this.nativeElement.firstElementChild.className = 'ng-scroll-layer';
        }
    };
    /**
     * Set this directive as  the viewport, called when no custom viewport is used
     */
    ScrollViewport.prototype.setAsViewport = function (customClassName) {
        this.nativeElement.className = "ng-native-scrollbar-hider ng-scroll-viewport " + customClassName;
        // Check if the custom viewport has only one child and set it as the content wrapper
        if (this.nativeElement.firstElementChild) {
            this.contentWrapperElement = this.nativeElement.firstElementChild;
            this.contentWrapperElement.classList.add('ng-scroll-content');
        }
    };
    /**
     * Scroll viewport vertically
     */
    ScrollViewport.prototype.scrollYTo = function (value) {
        this.nativeElement.scrollTop = value;
    };
    /**
     * Scroll viewport horizontally
     */
    ScrollViewport.prototype.scrollXTo = function (value) {
        this.nativeElement.scrollLeft = value;
    };
    ScrollViewport.ctorParameters = function () { return [
        { type: ElementRef },
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
    ]; };
    ScrollViewport = __decorate([
        Directive({
            selector: '[scrollViewport]'
        }),
        __param(1, Inject(DOCUMENT)),
        __metadata("design:paramtypes", [ElementRef, Object])
    ], ScrollViewport);
    return ScrollViewport;
}());
export { ScrollViewport };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsLXZpZXdwb3J0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNjcm9sbGJhci8iLCJzb3VyY2VzIjpbImxpYi9zY3JvbGwtdmlld3BvcnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQ2hFLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFLckQ7SUFrREUsd0JBQW1CLFFBQW9CLEVBQ0QsUUFBYTtRQURoQyxhQUFRLEdBQVIsUUFBUSxDQUFZO1FBQ0QsYUFBUSxHQUFSLFFBQVEsQ0FBSztRQUNqRCxJQUFJLENBQUMsYUFBYSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUM7SUFDOUMsQ0FBQztJQXpDRCxzQkFBSSx3Q0FBWTtRQURoQixpREFBaUQ7YUFDakQ7WUFDRSxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDO1FBQ3pDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksdUNBQVc7YUFBZjtZQUNFLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUM7UUFDeEMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSx3Q0FBWTthQUFoQjtZQUNFLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUM7UUFDekMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSx1Q0FBVzthQUFmO1lBQ0UsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQztRQUN4QyxDQUFDOzs7T0FBQTtJQUdE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QUFhLENBQUMsaUJBQWlCLEVBQUU7WUFDeEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLEdBQUcsaUJBQWlCLENBQUM7U0FDcEU7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxzQ0FBYSxHQUFiLFVBQWMsZUFBdUI7UUFDbkMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEdBQUcsa0RBQWdELGVBQWlCLENBQUM7UUFDakcsb0ZBQW9GO1FBQ3BGLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsRUFBRTtZQUN4QyxJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBZ0MsQ0FBQztZQUNqRixJQUFJLENBQUMscUJBQXFCLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1NBQy9EO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsa0NBQVMsR0FBVCxVQUFVLEtBQWE7UUFDckIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO0lBQ3ZDLENBQUM7SUFFRDs7T0FFRztJQUNILGtDQUFTLEdBQVQsVUFBVSxLQUFhO1FBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztJQUN4QyxDQUFDOztnQkF0RTRCLFVBQVU7Z0RBQzFCLE1BQU0sU0FBQyxRQUFROztJQW5EakIsY0FBYztRQUgxQixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsa0JBQWtCO1NBQzdCLENBQUM7UUFvRGEsV0FBQSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUE7eUNBREEsVUFBVTtPQWxENUIsY0FBYyxDQXlIMUI7SUFBRCxxQkFBQztDQUFBLEFBekhELElBeUhDO1NBekhZLGNBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIEluamVjdCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgZnJvbUV2ZW50LCBtZXJnZSwgT2JzZXJ2YWJsZSwgU3Vic2NyaWJlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAsIHRha2VVbnRpbCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgc3RvcFByb3BhZ2F0aW9uIH0gZnJvbSAnLi9zY3JvbGxiYXIvY29tbW9uJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3Njcm9sbFZpZXdwb3J0XSdcbn0pXG5leHBvcnQgY2xhc3MgU2Nyb2xsVmlld3BvcnQge1xuICAvLyBWaWV3cG9ydCBlbGVtZW50XG4gIHJlYWRvbmx5IG5hdGl2ZUVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICAvLyBDb250ZW50IHdyYXBwZXIgZWxlbWVudFxuICBjb250ZW50V3JhcHBlckVsZW1lbnQhOiBIVE1MRWxlbWVudDtcblxuICAvLyBTdHJlYW0gdGhhdCBlbWl0cyB3aGVuIHBvaW50ZXIgZXZlbnQgd2hlbiB0aGUgdmlld3BvcnQgaXMgaG92ZXJlZCBhbmQgZW1pdHMgZmFsc2UgdmFsdWUgd2hlbiBpc24ndCBob3ZlcmVkXG4gIGhvdmVyZWQhOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuICAvLyBTdHJlYW0gdGhhdCBlbWl0cyB3aGVuIHZpZXdwb3J0IGlzIGNsaWNrZWRcbiAgY2xpY2tlZCE6IE9ic2VydmFibGU8YW55PjtcblxuICAvLyBHZXQgdmlld3BvcnQgc2l6ZSwgY2xpZW50SGVpZ2h0IG9yIGNsaWVudFdpZHRoXG4gIGdldCBjbGllbnRIZWlnaHQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgfVxuXG4gIGdldCBjbGllbnRXaWR0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGg7XG4gIH1cblxuICBnZXQgc2Nyb2xsSGVpZ2h0KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubmF0aXZlRWxlbWVudC5zY3JvbGxIZWlnaHQ7XG4gIH1cblxuICBnZXQgc2Nyb2xsV2lkdGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5uYXRpdmVFbGVtZW50LnNjcm9sbFdpZHRoO1xuICB9XG5cbiAgLy8gR2V0IHZpZXdwb3J0IHNjcm9sbCBvZmZzZXQsIHNjcm9sbFRvcCBvciBzY3JvbGxMZWZ0XG4gIGdldCBzY3JvbGxUb3AoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcDtcbiAgfVxuXG4gIGdldCBzY3JvbGxMZWZ0KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0O1xuICB9XG5cbiAgLy8gR2V0IHRoZSBhdmFpbGFibGUgc2Nyb2xsYWJsZSBzaXplXG4gIGdldCBzY3JvbGxNYXhYKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuc2Nyb2xsV2lkdGggLSB0aGlzLmNsaWVudFdpZHRoO1xuICB9XG5cbiAgZ2V0IHNjcm9sbE1heFkoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5zY3JvbGxIZWlnaHQgLSB0aGlzLmNsaWVudEhlaWdodDtcbiAgfVxuXG4gIGdldCBjb250ZW50SGVpZ2h0KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY29udGVudFdyYXBwZXJFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB2aWV3UG9ydDogRWxlbWVudFJlZixcbiAgICAgICAgICAgICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudDogYW55KSB7XG4gICAgdGhpcy5uYXRpdmVFbGVtZW50ID0gdmlld1BvcnQubmF0aXZlRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBY3RpdmF0ZSB2aWV3cG9ydCBwb2ludGVyIGV2ZW50cyBzdWNoIGFzICdob3ZlcmVkJyBhbmQgJ2NsaWNrZWQnIGV2ZW50c1xuICAgKi9cbiAgYWN0aXZhdGVQb2ludGVyRXZlbnRzKHByb3BhZ2F0ZTogYm9vbGVhbiwgZGVzdHJveWVkOiBPYnNlcnZhYmxlPHZvaWQ+KTogdm9pZCB7XG4gICAgdGhpcy5ob3ZlcmVkID0gbmV3IE9ic2VydmFibGUoKHN1YnNjcmliZXI6IFN1YnNjcmliZXI8Ym9vbGVhbj4pID0+IHtcbiAgICAgIC8vIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gcG9pbnRlciBpcyBtb3ZlZCBvdmVyIHRoZSB2aWV3cG9ydCAodXNlZCB0byBzZXQgdGhlIGhvdmVyZWQgc3RhdGUpXG4gICAgICBjb25zdCBtb3VzZU1vdmVTdHJlYW0gPSBmcm9tRXZlbnQodGhpcy5uYXRpdmVFbGVtZW50LCAnbW91c2Vtb3ZlJywgeyBwYXNzaXZlOiB0cnVlIH0pO1xuICAgICAgY29uc3QgbW91c2VNb3ZlID0gcHJvcGFnYXRlID8gbW91c2VNb3ZlU3RyZWFtIDogbW91c2VNb3ZlU3RyZWFtLnBpcGUoc3RvcFByb3BhZ2F0aW9uKCkpO1xuICAgICAgLy8gU3RyZWFtIHRoYXQgZW1pdHMgd2hlbiBwb2ludGVyIGxlYXZlcyB0aGUgdmlld3BvcnQgKHVzZWQgdG8gcmVtb3ZlIHRoZSBob3ZlcmVkIHN0YXRlKVxuICAgICAgY29uc3QgbW91c2VMZWF2ZSA9IGZyb21FdmVudCh0aGlzLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWxlYXZlJykucGlwZShtYXAoKCkgPT4gZmFsc2UpKTtcbiAgICAgIG1lcmdlKG1vdXNlTW92ZSwgbW91c2VMZWF2ZSkucGlwZShcbiAgICAgICAgdGFwKChlOiBmYWxzZSB8IGFueSkgPT4gc3Vic2NyaWJlci5uZXh0KGUpKSxcbiAgICAgICAgdGFrZVVudGlsKGRlc3Ryb3llZClcbiAgICAgICkuc3Vic2NyaWJlKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNsaWNrZWQgPSBuZXcgT2JzZXJ2YWJsZSgoc3Vic2NyaWJlcjogU3Vic2NyaWJlcjxhbnk+KSA9PiB7XG4gICAgICBjb25zdCBtb3VzZURvd24gPSBmcm9tRXZlbnQodGhpcy5uYXRpdmVFbGVtZW50LCAnbW91c2Vkb3duJywgeyBwYXNzaXZlOiB0cnVlIH0pLnBpcGUoXG4gICAgICAgIHRhcCgoZTogYW55KSA9PiBzdWJzY3JpYmVyLm5leHQoZSkpXG4gICAgICApO1xuICAgICAgY29uc3QgbW91c2VVcCA9IGZyb21FdmVudCh0aGlzLm5hdGl2ZUVsZW1lbnQsICdtb3VzZXVwJywgeyBwYXNzaXZlOiB0cnVlIH0pLnBpcGUoXG4gICAgICAgIHRhcCgoKSA9PiBzdWJzY3JpYmVyLm5leHQoZmFsc2UpKVxuICAgICAgKTtcbiAgICAgIG1vdXNlRG93bi5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gbW91c2VVcCksXG4gICAgICAgIHRha2VVbnRpbChkZXN0cm95ZWQpXG4gICAgICApLnN1YnNjcmliZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGlzIGRpcmVjdGl2ZSBhcyBhIG5vbi1mdW5jdGlvbmFsIHdyYXBwZXIsIGNhbGxlZCB3aGVuIGEgY3VzdG9tIHZpZXdwb3J0IGlzIHVzZWRcbiAgICovXG4gIHNldEFzV3JhcHBlcigpOiB2b2lkIHtcbiAgICAvLyBJbiB0aGlzIGNhc2UgdGhlIGRlZmF1bHQgdmlld3BvcnQgYW5kIHRoZSBkZWZhdWx0IGNvbnRlbnQgd3JhcHBlciB3aWxsIGFjdCBhcyBhIG1hc2tcbiAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuY2xhc3NOYW1lID0gJ25nLW5hdGl2ZS1zY3JvbGxiYXItaGlkZXIgbmctc2Nyb2xsLWxheWVyJztcbiAgICBpZiAodGhpcy5uYXRpdmVFbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKSB7XG4gICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQuY2xhc3NOYW1lID0gJ25nLXNjcm9sbC1sYXllcic7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGlzIGRpcmVjdGl2ZSBhcyAgdGhlIHZpZXdwb3J0LCBjYWxsZWQgd2hlbiBubyBjdXN0b20gdmlld3BvcnQgaXMgdXNlZFxuICAgKi9cbiAgc2V0QXNWaWV3cG9ydChjdXN0b21DbGFzc05hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMubmF0aXZlRWxlbWVudC5jbGFzc05hbWUgPSBgbmctbmF0aXZlLXNjcm9sbGJhci1oaWRlciBuZy1zY3JvbGwtdmlld3BvcnQgJHtjdXN0b21DbGFzc05hbWV9YDtcbiAgICAvLyBDaGVjayBpZiB0aGUgY3VzdG9tIHZpZXdwb3J0IGhhcyBvbmx5IG9uZSBjaGlsZCBhbmQgc2V0IGl0IGFzIHRoZSBjb250ZW50IHdyYXBwZXJcbiAgICBpZiAodGhpcy5uYXRpdmVFbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKSB7XG4gICAgICB0aGlzLmNvbnRlbnRXcmFwcGVyRWxlbWVudCA9IHRoaXMubmF0aXZlRWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZCBhcyBIVE1MRWxlbWVudDtcbiAgICAgIHRoaXMuY29udGVudFdyYXBwZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ25nLXNjcm9sbC1jb250ZW50Jyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNjcm9sbCB2aWV3cG9ydCB2ZXJ0aWNhbGx5XG4gICAqL1xuICBzY3JvbGxZVG8odmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMubmF0aXZlRWxlbWVudC5zY3JvbGxUb3AgPSB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTY3JvbGwgdmlld3BvcnQgaG9yaXpvbnRhbGx5XG4gICAqL1xuICBzY3JvbGxYVG8odmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0ID0gdmFsdWU7XG4gIH1cbn1cbiJdfQ==